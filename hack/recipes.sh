#!/bin/bash -eu
set -o pipefail

gh run download --pattern '*.Dockerfile'

for f in *.Dockerfile/*.Dockerfile; do
	echo $f
	mv $f recipes/
	rmdir $(dirname $f)
	f=recipes/$(basename $f)

	if git --no-pager diff --exit-code -I '^# Generated by' -I ' AS rust-base$' -I '^# syntax=docker.io/docker/dockerfile:1@' -- $f; then
		git checkout -- $f
	fi
done
